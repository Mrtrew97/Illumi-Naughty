<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Illumi-Naughty Data</title>
  <link rel="icon" href="https://i.imgur.com/hJT4Uhx.png" type="image/png" />
  <style>
    :root {
      --horizontal-gap: 20px;
      --vertical-gap: 20px;
    }

    body {
      font-family: Arial, sans-serif;
      margin: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      height: 100vh;
      text-align: center;
      background: linear-gradient(0deg, #00000088 100%, #ffffff44 100%), url("https://i.imgur.com/hJT4Uhx.png") no-repeat center center fixed;
      background-size: cover;
      background-attachment: fixed;
      position: relative;
    }

    .header-banner {
      width: 100%;
      height: 250px;
      background-image: url("https://i.imgur.com/tPCIVo0.png");
      background-size: cover;
      background-position: left 0% top 49%;
    }

    .search-container {
      position: relative;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      width: 100%;
      margin-top: 20px;
    }

    #search {
      width: 300px;
      padding: 10px;
      font-size: 16px;
      border: 4px double #000;
      outline: 3px solid #000;
      outline-offset: 2px;
      border-radius: 5px;
      background: #b4b4b4;
      text-align: center;
      margin-bottom: 5px;
    }

    #dropdown {
      width: 320px;
      max-height: 150px;
      overflow-y: auto;
      background: #b4b4b4;
      border: 4px double #000;
      border-top: none;
      position: absolute;
      top: 40px;
      z-index: 10;
      display: none;
      font-size: 16px;
      color: #000;
    }

    #dropdown div {
      padding: 10px;
      cursor: pointer;
    }

    #dropdown div:hover {
      background-color: #ddd;
    }

    #data-container {
      margin-top: 20px;
      display: flex;
      flex-direction: column;
      gap: var(--vertical-gap);
      width: 80%;
      max-width: 800px;
    }

    .data-box {
      width: 150px;
      height: 50px;
      padding: 10px;
      background-color: #b4b4b4;
      border: 4px double #000;
      outline: 3px solid #000;
      outline-offset: 2px;
      border-radius: 5px;
      text-align: center;
      flex-shrink: 0;
    }

    .hidden-placeholder {
      visibility: hidden;
      width: 150px;
      height: 50px;
      flex-shrink: 0;
    }

    .data-box h3 {
      margin: 0;
      font-size: 18px;
      color: #000000;
    }

    .data-box p {
      margin: 5px 0 0;
      font-size: 16px;
      font-weight: bold;
      color: #000;
    }

    .row {
      display: flex;
      justify-content: space-between;
      flex-wrap: nowrap;
    }
  </style>
</head>

<body>
  <div class="header-banner"></div>
  <div class="search-container">
    <input type="text" id="search" placeholder="Search for a name..." autocomplete="off" />
    <div id="dropdown"></div>
  </div>
  <div id="data-container"></div>
  <script>
    let sheetData = [];
    const scriptURL = "https://script.google.com/macros/s/AKfycbxvCXxshI7Nb8k3ETICeV35DhztIb2YTh2qQF9JFrBHq_pfAnhmIihmO_-KjKUn54sl/exec";

    async function fetchData() {
      try {
        let response = await fetch(scriptURL, { method: "GET", mode: "cors" });
        sheetData = await response.json();
      } catch (error) {
        console.error("Error fetching data:", error);
      }
    }

    function searchPerson() {
      const query = document.getElementById("search").value.toLowerCase();
      const dropdown = document.getElementById("dropdown");
      dropdown.innerHTML = "";
      if (query.length > 0) {
        const filteredData = sheetData.filter(
          (p) =>
            p["Name"].toLowerCase().includes(query) ||
            (p["ID"] && p["ID"].toString().includes(query))
        );
        dropdown.style.display = filteredData.length > 0 ? "block" : "none";
        filteredData.forEach((person) => {
          const div = document.createElement("div");
          div.textContent = person["Name"] + " (ID: " + person["ID"] + ")";
          div.addEventListener("click", () => {
            document.getElementById("search").value = person["Name"];
            dropdown.style.display = "none";
            displayData(person);
          });
          dropdown.appendChild(div);
        });
      } else {
        dropdown.style.display = "none";
      }
    }

    function displayData(person) {
      let container = document.getElementById("data-container");
      container.innerHTML = "";

      const fields = [
        { field: "AP", label: "AP" },
        { field: "AP Average", label: "AP Average" },
        { field: "AP Gain Average", label: "AP Gain Average" },
        { field: "AP Gain", label: "AP Gain" },
        { field: "Merits", label: "Merits" },
        { field: "Merits Percentage", label: "Merits %" },
        { field: "Merits Gained Percentage", label: "Merits Gained %" },
        { field: "Merits Gained", label: "Merits Gained" },
        { field: "Power Change", label: "Power Change" },
        { field: "Heal Change", label: "Heal Change" },
        { field: "Kill Change", label: "Kill Change" },
        { field: "Death Change", label: "Death Change" },
        { field: "Behemoths", label: "Behemoths" },
        { field: "Weekly Helps", label: "Helps" },
        { field: "Weekly Donations", label: "Donations" },
        { field: "Weekly Build", label: "Build" }
      ];

      const boxElems = fields.map(({ field, label }) => {
        let value = person[field] || "0";
        if (field === "Merits Percentage" && value === "#DIV/0!") {
          value = "0";
        } else if (!isNaN(value)) {
          value = Number(value).toFixed(2);
          if (parseFloat(value) === parseInt(value)) {
            value = parseInt(value).toString();
          }
        }
        const div = document.createElement("div");
        div.className = "data-box";
        div.innerHTML = `<h3>${label}</h3><p>${value}</p>`;
        return div;
      });

      let rssValueRaw = person["Rss Total Season"] || "0";
      let rssValue = rssValueRaw;
      if (!isNaN(rssValueRaw)) {
        rssValue = Number(rssValueRaw).toFixed(2);
        if (parseFloat(rssValue) === parseInt(rssValue)) {
          rssValue = parseInt(rssValue).toString();
        }
      }
      const rssBox = document.createElement("div");
      rssBox.className = "data-box";
      rssBox.innerHTML = `<h3>Rss Gather</h3><p>${rssValue}</p>`;

      let runicRaw = person["Runic Points Season"] || "0";
      let runicValue = runicRaw;
      if (!isNaN(runicRaw)) {
        runicValue = Number(runicRaw).toFixed(2);
        if (parseFloat(runicValue) === parseInt(runicValue)) {
          runicValue = parseInt(runicValue).toString();
        }
      }
      const runicBox = document.createElement("div");
      runicBox.className = "data-box";
      runicBox.innerHTML = `<h3>Runic Points</h3><p>${runicValue}</p>`;

      const totalIds = sheetData.filter(p => p["ID"]).length;

      const rankValue = person["Rank"] ? parseInt(person["Rank"]) : 0;
      const rankBox = document.createElement("div");
      rankBox.className = "data-box";
      rankBox.innerHTML = `<h3>Rank</h3><p>${rankValue} out of ${totalIds}</p>`;

      const fromHelperRaw = person["Helper 2"] || "??";
      const toHelperRaw = person["Helper 1"] || "??";

      const fromHelper = fromHelperRaw.replace(/-2025$/, "");
      const toHelper = toHelperRaw.replace(/-2025$/, "");

      const dataPeriodVal = `From ${fromHelper} to ${toHelper}`;
      const dataPeriodBox = document.createElement("div");
      dataPeriodBox.className = "data-box";
      dataPeriodBox.innerHTML = `<h3>Data Period</h3><p>${dataPeriodVal}</p>`;

      const layout = [
        boxElems.slice(0, 4),
        boxElems.slice(4, 8),
        boxElems.slice(8, 12),
        boxElems.slice(12, 16),
        [rssBox, runicBox, rankBox, dataPeriodBox]
      ];

      layout.forEach((row) => {
        const rowDiv = document.createElement("div");
        rowDiv.className = "row";
        row.forEach((box) => rowDiv.appendChild(box));
        container.appendChild(rowDiv);
      });
    }

    document.getElementById("search").addEventListener("input", searchPerson);
    fetchData();
  </script>
</body>

</html>